basePath: /api
definitions:
  agents.fileInfo:
    properties:
      mod_time:
        description: 修改时间
        example: 1663816771
        type: integer
      name:
        description: 文件名
        example: metrics-agent.log
        type: string
      size:
        description: 文件大小
        example: 155
        type: integer
    required:
    - mod_time
    - name
    - size
    type: object
  agents.info:
    properties:
      arch:
        description: 操作系统位数
        enum:
        - i386
        - x86_64
        - '...'
        example: x86_64
        type: string
      id:
        description: agent-id
        example: ct-01
        type: string
      ip:
        description: ip地址
        example: 127.0.0.1
        type: string
      is_busy:
        description: 是否处于忙碌状态
        example: false
        type: boolean
      mac:
        description: mac地址
        example: 00:15:5d:c9:e0:17
        type: string
      os:
        description: 操作系统类型
        enum:
        - windows
        - linux
        example: linux
        type: string
      platform:
        description: 操作系统名称
        enum:
        - debian
        - centos
        - '...'
        example: debian
        type: string
      type:
        description: agent类型
        example: container-agent
        type: string
      version:
        description: agent版本号
        example: 1.0.0
        type: string
    required:
    - arch
    - id
    - ip
    - is_busy
    - mac
    - os
    - platform
    - type
    - version
    type: object
  api.Success:
    properties:
      code:
        description: 状态码
        example: 200
        type: integer
      extime:
        description: 耗时(毫秒)
        example: 70
        type: integer
      payload:
        description: 内容
    required:
    - code
    - extime
    type: object
  exec.info:
    properties:
      begin:
        description: 启动时间
        example: 1665219359
        type: integer
      pid:
        description: 进程号
        example: 11186
        type: integer
      task_id:
        description: 任务ID
        example: 20221008-00001-7a390a60f759aab5
        type: string
    required:
    - begin
    - pid
    - task_id
    type: object
  exec.result:
    properties:
      code:
        description: 任务的返回状态
        example: 0
        type: integer
      data:
        description: 返回内容（base64编码）
        type: string
      end:
        description: 任务结束时间
        example: 1663816771
        type: integer
      running:
        description: 任务是否还在执行中
        example: true
        type: boolean
    required:
    - code
    - running
    type: object
  exec.runArgs:
    properties:
      args:
        description: 参数
        example:
        - hello world
        items:
          type: string
        type: array
      auth:
        description: 提权方式，仅linux有效
        enum:
        - ""
        - sudo
        - su
        example: sudo
        type: string
      cmd:
        description: 命令
        example: echo
        type: string
      env:
        description: 环境变量
        example:
        - DB_HOST=127.0.0.1
        - DB_NAME=jkstack
        items:
          type: string
        type: array
      result:
        default: true
        description: 是否直接返回数据
        example: true
        type: boolean
      timeout:
        default: 60
        description: 超时时间
        example: 3600
        type: integer
      user:
        description: 运行身份，仅linux有效
        example: nobody
        type: string
      workdir:
        description: 工作目录
        example: /var/log
        type: string
    required:
    - cmd
    type: object
  exec.runPayload:
    properties:
      begin:
        description: 开始时间戳
        example: 1663816771
        type: integer
      id:
        description: 任务ID
        example: 20220922-00001-4bc99720760771f6
        type: string
      pid:
        description: 进程ID
        example: 9655
        type: integer
      result:
        allOf:
        - $ref: '#/definitions/exec.result'
        description: 任务状态，仅当result参数为true时返回
    required:
    - begin
    - id
    - pid
    type: object
  exec.status:
    properties:
      begin:
        description: 任务开始时间
        example: 1663816771
        type: integer
      code:
        description: 运行结果状态码
        example: 0
        type: integer
      done:
        description: 该任务是否已执行完毕
        example: false
        type: boolean
      end:
        description: 结束时间，仅当running=false时返回
        example: 1663816771
        type: integer
    required:
    - begin
    - done
    type: object
  file.info:
    properties:
      auth:
        description: 文件权限（10进制）
        example: 777
        type: integer
      group:
        description: 所属组
        example: root
        type: string
      is_dir:
        description: 是否是目录
        example: true
        type: boolean
      is_link:
        description: 是否是软链
        example: false
        type: boolean
      link_dir:
        description: 连接路径
        example: /usr/bin
        type: string
      mod_time:
        description: 更新时间
        example: 1663816771
        type: integer
      name:
        description: 文件名
        example: bin
        type: string
      size:
        description: 文件大小
        example: 155
        type: integer
      user:
        description: 所属用户
        example: root
        type: string
    required:
    - auth
    - is_dir
    - is_link
    - mod_time
    - name
    - size
    type: object
  info.serverInfo:
    properties:
      agents:
        description: 当前连接的agent数量
        example: 10
        type: integer
      id:
        description: 集群ID
        example: cluster-01
        type: string
      is_blocking:
        description: 是否处于限流状态
        example: false
        type: boolean
      version:
        description: 服务端版本号
        example: 1.0.0
        type: string
    required:
    - agents
    - id
    - is_blocking
    - version
    type: object
  ipmi.deviceInfo:
    properties:
      firmware_version:
        default: "0.0"
        description: 固件版本
        type: string
      ipmi_version:
        default: "2.0"
        description: IPMI版本
        type: string
      oem:
        default: IBM
        description: 生产厂商
        type: string
    required:
    - firmware_version
    - ipmi_version
    - oem
    type: object
  ipmi.sensorCritical:
    properties:
      critical:
        default: 70
        description: 告警数值
        type: number
      non_critical:
        default: 60
        description: 恢复数值
        type: number
      non_recoverable:
        default: 100
        description: 严重告警数值
        type: number
    type: object
  ipmi.sensorInfo:
    properties:
      discrete:
        default: false
        description: 是否是离散传感器
        type: boolean
      entity_id:
        default: "12.1"
        description: 实体ID
        type: string
      id:
        default: 0
        description: 传感器序号
        type: integer
      name:
        default: Ambient Temp
        description: 传感器名称
        type: string
      sensor_id:
        default: 44
        description: 传感器ID
        type: integer
      type:
        default: Temperature
        description: 传感器类型
        type: string
      values:
        allOf:
        - $ref: '#/definitions/ipmi.sensorValue'
        description: 传感器数值
    required:
    - discrete
    - entity_id
    - id
    - name
    - sensor_id
    - type
    type: object
  ipmi.sensorUnitValue:
    properties:
      base:
        default: degrees C
        description: 基本单位
        type: string
      mod:
        default: minute
        description: 第二项单位
        type: string
      op:
        default: /
        description: 乘或除
        type: string
      percent:
        default: false
        description: 是否是百分比
        type: boolean
    required:
    - base
    - percent
    type: object
  ipmi.sensorValue:
    properties:
      current:
        default: 23
        description: 当前数值
        type: number
      lower:
        allOf:
        - $ref: '#/definitions/ipmi.sensorCritical'
        description: 最低告警数值
      unit:
        allOf:
        - $ref: '#/definitions/ipmi.sensorUnitValue'
        description: 当前传感器的单位信息
      upper:
        allOf:
        - $ref: '#/definitions/ipmi.sensorCritical'
        description: 最高告警数值
    required:
    - current
    - unit
    type: object
  layout.nodeStatus:
    properties:
      begin:
        description: 开始时间
        example: 1663816771
        type: integer
      end:
        description: 仅当status=done时返回
        example: 1663816771
        type: integer
      err:
        description: 错误信息
        example: xxx not found
        type: string
      id:
        description: 节点ID
        example: exec-01
        type: string
      status:
        description: 当前状态
        enum:
        - waiting
        - running
        - done
        example: waiting
        type: string
    required:
    - begin
    - id
    - status
    type: object
  layout.status:
    properties:
      begin:
        description: 开始时间
        example: 1663816771
        type: integer
      done:
        description: 该任务是否已执行完毕
        example: false
        type: boolean
      end:
        description: 结束时间，仅当done=true时返回
        example: 1663816771
        type: integer
      index:
        description: 当前正在运行的批次号
        example: 0
        type: integer
      nodes:
        description: 节点状态列表
        items:
          $ref: '#/definitions/layout.nodeStatus'
        type: array
    required:
    - begin
    - done
    - index
    type: object
  metrics.batchSetArgs:
    properties:
      os:
        description: 操作系统
        enum:
        - linux
        - windows
        example: linux
        type: string
      start:
        description: 是否启动
        example: true
        type: boolean
    required:
    - start
    type: object
  metrics.connection:
    properties:
      fd:
        description: 句柄号
        example: 8
        type: integer
      local:
        description: 本地地址
        example: 127.0.0.1:13081
        type: string
      pid:
        description: 所属进程ID
        example: 28093
        type: integer
      remote:
        description: 远程地址
        example: 127.0.0.1:37470
        type: string
      status:
        description: 连接状态
        enum:
        - ""
        - ESTABLISHED
        - SYN_SENT
        - SYN_RECEIVED
        - SYN_RECV
        - FIN_WAIT_1
        - FIN_WAIT_2
        - FIN_WAIT1
        - FIN_WAIT2
        - TIME_WAIT
        - CLOSE
        - CLOSED
        - CLOSE_WAIT
        - LAST_ACK
        - LISTEN
        - CLOSING
        - DELETE
        example: ESTABLISHED
        type: string
      type:
        description: 连接类型
        enum:
        - tcp4
        - tcp6
        - udp4
        - udp6
        - unix
        - file
        example: tcp4
        type: string
    required:
    - fd
    - pid
    - status
    - type
    type: object
  metrics.core:
    properties:
      core:
        description: 所在物理核上的编号
        example: 0
        type: integer
      cores:
        description: 某块CPU上的编号
        example: 0
        type: integer
      mhz:
        description: 核心频率
        example: 1600
        type: number
      model:
        description: CPU型号
        example: Intel(R) Xeon(R) CPU E5-2620 v2 @ 2.10GHz
        type: string
      physical:
        description: 物理CPU编号
        example: 0
        type: integer
      processor:
        description: 第几个核心
        example: 0
        type: integer
    required:
    - core
    - cores
    - mhz
    - model
    - physical
    - processor
    type: object
  metrics.counts:
    properties:
      failure:
        description: 失败节点数
        example: 0
        type: integer
      success:
        description: 成功节点数
        example: 10
        type: integer
      total:
        description: 触达节点数
        example: 10
        type: integer
    required:
    - failure
    - success
    - total
    type: object
  metrics.disk:
    properties:
      disks:
        description: 逻辑分区
        example:
        - /boot
        - /home
        items:
          type: string
        type: array
      model:
        description: 品牌型号
        example: Samsung SSD 870 QVO 1TB
        type: string
      total:
        description: 容量
        example: 1000204886016
        type: integer
      type:
        description: 磁盘类型
        enum:
        - HDD
        - SSD
        example: HDD
        type: string
    required:
    - model
    - total
    - type
    type: object
  metrics.dynamicInfo:
    properties:
      connections:
        description: 连接列表
        items:
          $ref: '#/definitions/metrics.connection'
        type: array
      process:
        description: 进程列表
        items:
          $ref: '#/definitions/metrics.process'
        type: array
      temperatures:
        description: 传感器温度列表
        items:
          $ref: '#/definitions/metrics.temp'
        type: array
      usage:
        allOf:
        - $ref: '#/definitions/metrics.usage'
        description: usage数据
    type: object
  metrics.interfaceUsage:
    properties:
      bytes_recv:
        description: 接收字节数
        example: 24422
        type: integer
      bytes_sent:
        description: 发送字节数
        example: 6162729
        type: integer
      name:
        description: 网卡名称
        example: eth0
        type: string
      packets_recv:
        description: 接收数据包数量
        example: 4399
        type: integer
      packets_sent:
        description: 发送数据包数量
        example: 5699
        type: integer
    required:
    - bytes_recv
    - bytes_sent
    - name
    - packets_recv
    - packets_sent
    type: object
  metrics.intf:
    properties:
      addrs:
        description: 网卡上绑定的IP地址列表
        example:
        - 192.168.1.100
        items:
          type: string
        type: array
      flags:
        description: 网卡附加参数
        example:
        - UP
        - BROADCAST
        - RUNNING
        - MULTICAST
        items:
          type: string
        type: array
      index:
        description: 网卡下标
        example: 0
        type: integer
      mac:
        description: 网卡mac地址
        example: 26:29:93:f2:84:22
        type: string
      mtu:
        description: 网卡mtu
        example: 1500
        type: integer
      name:
        description: 网卡名称
        example: lo
        type: string
    required:
    - index
    - mac
    - mtu
    - name
    type: object
  metrics.job:
    properties:
      interval:
        description: 间隔时间
        example: 5
        type: integer
      name:
        description: 任务名称
        enum:
        - static
        - usage
        - process
        - conns
        example: static
        type: string
    required:
    - interval
    - name
    type: object
  metrics.partition:
    properties:
      fstype:
        description: 文件系统类型
        example: NTFS
        type: string
      inodes:
        description: inode数量
        example: 4072701
        type: integer
      mount:
        description: 'linux为挂载路径如/run，windows为盘符如C:'
        example: /boot
        type: string
      opts:
        description: 附加信息
        example:
        - rw
        - nosuid
        - nodev
        items:
          type: string
        type: array
      total:
        description: 总容量
        example: 209666048
        type: integer
    required:
    - mount
    - total
    type: object
  metrics.partitionUsage:
    properties:
      free:
        description: 剩余字节数
        example: 232815064
        type: integer
      inode_free:
        description: inode剩余数量
        example: 15998934
        type: integer
      inode_usage:
        description: inode使用率
        example: 5.64
        type: number
      inode_used:
        description: inode已使用数量
        example: 778282
        type: integer
      iops_in_progress:
        description: 正在等待的IO操作数量
        example: 0
        type: integer
      name:
        description: 'linux为挂载路径如/run，windows为盘符如C:'
        example: /
        type: string
      read_per_second:
        description: 每秒读取字节数
        example: 100
        type: number
      usage:
        description: 磁盘使用率
        example: 6.27
        type: number
      used:
        description: 已使用字节数
        example: 16920992
        type: integer
      write_per_second:
        description: 每秒写入字节数
        example: 200
        type: number
    required:
    - free
    - name
    - read_per_second
    - usage
    - used
    - write_per_second
    type: object
  metrics.process:
    properties:
      cmd:
        description: 命令行
        example:
        - /usr/bin/zsh
        - -i
        items:
          type: string
        type: array
      conns:
        description: 连接数
        example: 16
        type: integer
      cpu_usage:
        description: CPU使用率
        example: 3.2
        type: number
      id:
        description: 进程ID
        example: 5167
        type: integer
      listen:
        description: 监听端口
        example:
        - 8080
        - 9090
        items:
          type: integer
        type: array
      memory_usage:
        description: 内存使用率
        example: 6.4
        type: number
      pid:
        description: 父进程ID
        example: 1
        type: integer
      rss:
        description: 物理内存数
        example: 37654
        type: integer
      swap:
        description: swap内存数
        example: 0
        type: integer
      user:
        description: 用户
        example: root
        type: string
      vms:
        description: 虚拟内存数
        example: 26754
        type: integer
    required:
    - conns
    - id
    - pid
    - user
    type: object
  metrics.setArgs:
    properties:
      jobs:
        description: 需启动的任务类型
        example:
        - static
        - usage
        items:
          enum:
          - static
          - usage
          - process
          - conns
          type: string
        type: array
    required:
    - jobs
    type: object
  metrics.staticInfo:
    properties:
      cpu:
        properties:
          cores:
            description: 每个核心参数
            items:
              $ref: '#/definitions/metrics.core'
            type: array
          logical:
            description: 逻辑核心数
            example: 4
            type: integer
          physical:
            description: 物理核心数
            example: 2
            type: integer
        required:
        - logical
        - physical
        type: object
      disks:
        description: 物理磁盘列表
        items:
          $ref: '#/definitions/metrics.disk'
        type: array
      gateway:
        description: 网关地址
        example: 192.168.1.1
        type: string
      host:
        properties:
          name:
            description: 主机名
            example: DESKTOP-OQ8O3DR
            type: string
          uptime:
            description: 启动时长
            example: 1900
            type: integer
        required:
        - name
        - uptime
        type: object
      interface:
        description: 网卡列表
        items:
          $ref: '#/definitions/metrics.intf'
        type: array
      kernel:
        properties:
          arch:
            description: 位数
            enum:
            - x86_64
            - i386
            - '...'
            example: x86_64
            type: string
          version:
            description: 内核版本
            example: 3.10.0-1062.el7.x86_64
            type: string
        required:
        - arch
        - version
        type: object
      memory:
        properties:
          physical:
            description: 物理内存大小
            example: 33363566592
            type: integer
          swap:
            description: swap内存大小
            example: 8589930496
            type: integer
        required:
        - physical
        - swap
        type: object
      nameservers:
        description: DNS服务器地址列表
        example:
        - 192.168.1.1
        items:
          type: string
        type: array
      os:
        properties:
          install:
            description: 系统安装时间
            example: 1661396019
            type: integer
          name:
            description: 系统类型
            enum:
            - linux
            - windows
            example: linux
            type: string
          platform_name:
            description: 系统名称
            enum:
            - redhat
            - centos
            - debian
            - ubuntu
            - '...'
            example: centos
            type: string
          platform_version:
            description: 系统版本号
            example: 7.7.1908
            type: string
          startup:
            description: 系统启动时间
            example: 1661396019
            type: integer
        required:
        - install
        - name
        - platform_name
        - platform_version
        - startup
        type: object
      partitions:
        description: 逻辑分区列表
        items:
          $ref: '#/definitions/metrics.partition'
        type: array
      time:
        description: 客户端时间
        example: 1661396019
        type: integer
      user:
        description: 用户列表
        items:
          $ref: '#/definitions/metrics.user'
        type: array
    required:
    - cpu
    - gateway
    - host
    - kernel
    - memory
    - nameservers
    - os
    - time
    type: object
  metrics.status:
    properties:
      allow_conns:
        description: 采集的连接类型
        example:
        - tcp
        - udp
        items:
          enum:
          - tcp
          - tcp4
          - tcp6
          - udp
          - udp4
          - udp6
          - unix
          type: string
        type: array
      jobs:
        description: 正在运行的任务列表
        items:
          $ref: '#/definitions/metrics.job'
        type: array
    type: object
  metrics.temp:
    properties:
      name:
        description: 名称
        example: coretemp_core_0
        type: string
      temp:
        description: 温度
        example: 38
        type: number
    required:
    - name
    - temp
    type: object
  metrics.usage:
    properties:
      cpu:
        properties:
          load1:
            description: 1分钟负载
            example: 0.3
            type: number
          load5:
            description: 5分钟负载
            example: 0.4
            type: number
          load15:
            description: 15分钟负载
            example: 0.5
            type: number
          usage:
            description: CPU使用率(百分比)
            example: 2.3
            type: number
        required:
        - load1
        - load15
        - load5
        - usage
        type: object
      interface:
        description: 网卡
        items:
          $ref: '#/definitions/metrics.interfaceUsage'
        type: array
      memory:
        properties:
          available:
            description: 可用字节数
            example: 201332
            type: integer
          free:
            description: 剩余字节数
            example: 94896
            type: integer
          swap_free:
            description: swap剩余字节数
            example: 7242344
            type: integer
          swap_used:
            description: swap已使用字节数
            example: 1146264
            type: integer
          usage:
            description: 内存使用率(百分比)
            example: 1.2
            type: number
          used:
            description: 已使用字节数
            example: 1595712
            type: integer
        required:
        - available
        - free
        - swap_free
        - swap_used
        - usage
        - used
        type: object
      partitions:
        description: 分区
        items:
          $ref: '#/definitions/metrics.partitionUsage'
        type: array
    type: object
  metrics.user:
    properties:
      gid:
        description: 用户组ID
        example: "0"
        type: string
      id:
        description: 用户ID
        example: "0"
        type: string
      name:
        description: 用户名
        example: root
        type: string
    required:
    - gid
    - id
    - name
    type: object
  rpa.inSelectorArgs:
    properties:
      callback:
        description: 回调地址
        example: https://www.baidu.com
        type: string
      requestId:
        description: 请求ID
        example: 20230728...
        type: string
    type: object
  rpa.selectorValidateArgs:
    properties:
      content:
        description: 验证内容
        type: string
    type: object
  script.runPayload:
    properties:
      begin:
        description: 开始时间戳
        example: 1663816771
        type: integer
      code:
        description: 任务的返回状态
        example: 0
        type: integer
      data:
        description: 返回内容（base64编码）
        type: string
      end:
        description: 任务结束时间
        example: 1663816771
        type: integer
      id:
        description: 任务ID
        example: 20220922-00001-4bc99720760771f6
        type: string
    required:
    - begin
    - code
    - id
    type: object
info:
  contact:
    url: https://www.jkstack.com
  description: jkagent management server.
  title: agent-server
  version: TODO
paths:
  /agents:
    get:
      consumes:
      - application/json
      operationId: /api/agents
      parameters:
      - description: 节点类型,不指定则为所有
        enum:
        - example-agent
        - container-agent
        - metrics-agent
        - rpa-agent
        - '...'
        in: query
        name: type
        type: string
      - description: 节点操作系统,不指定则为所有
        enum:
        - linux
        - windows
        in: query
        name: os
        type: string
      - default: 1
        description: 分页编号
        in: query
        minimum: 1
        name: page
        type: integer
      - default: 20
        description: 每页数量
        in: query
        minimum: 10
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/agents.info'
                  type: array
              type: object
      summary: 获取节点列表
      tags:
      - agents
  /agents/{id}:
    get:
      consumes:
      - application/json
      operationId: /api/agents/info
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/agents.info'
              type: object
      summary: 获取某个节点信息
      tags:
      - agents
  /agents/{id}/log/download:
    get:
      consumes:
      - application/json
      operationId: /api/agents/log/download
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - collectionFormat: csv
        description: 文件列表
        in: query
        items:
          type: string
        name: files
        required: true
        type: array
      - default: 600
        description: 超时时间
        in: query
        minimum: 1
        name: timeout
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 文件内容
          schema:
            type: string
        "500":
          description: 出错原因
          schema:
            type: string
        "503":
          description: 出错原因
          schema:
            type: string
      summary: 下载某个agent下的日志文件
      tags:
      - agents
  /agents/{id}/logs:
    get:
      consumes:
      - application/json
      operationId: /api/agents/logs
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/agents.fileInfo'
                  type: array
              type: object
      summary: 获取某个节点下的日志文件列表
      tags:
      - agents
  /exec/{id}/kill/{pid}:
    delete:
      consumes:
      - application/json
      operationId: /api/exec/kill
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 进程号
        in: path
        name: pid
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 结束进程
      tags:
      - exec
  /exec/{id}/ps:
    get:
      consumes:
      - application/json
      operationId: /api/exec/ps
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/exec.info'
                  type: array
              type: object
      summary: 列出正在运行中的任务
      tags:
      - exec
  /exec/{id}/pty/{pid}:
    get:
      consumes:
      - application/json
      operationId: /api/exec/pty
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 进程号
        in: path
        name: pid
        required: true
        type: integer
      produces:
      - text/plain
      responses:
        "200":
          description: 输出内容
          schema:
            type: string
        "404":
          description: \<what\> not found
          schema:
            type: string
        "500":
          description: 出错原因
          schema:
            type: string
      summary: 获取返回内容
      tags:
      - exec
  /exec/{id}/run:
    post:
      consumes:
      - application/json
      operationId: /api/exec/run
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 需启动的任务列表
        in: body
        name: args
        required: true
        schema:
          $ref: '#/definitions/exec.runArgs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/exec.runPayload'
              type: object
      summary: 执行命令或脚本
      tags:
      - exec
  /exec/{id}/status/{pid}:
    get:
      consumes:
      - application/json
      operationId: /api/exec/status
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 进程号
        in: path
        name: pid
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/exec.status'
              type: object
      summary: 获取运行状态
      tags:
      - exec
  /file/{id}/download:
    get:
      consumes:
      - application/json
      operationId: /api/file/download
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 文件路径
        in: query
        name: dir
        required: true
        type: string
      - default: 600
        description: 超时时间
        in: query
        minimum: 1
        name: timeout
        type: integer
      produces:
      - text/plain
      responses:
        "200":
          description: 输出内容
          schema:
            type: string
        "404":
          description: file not found
          schema:
            type: string
        "500":
          description: 出错原因
          schema:
            type: string
        "503":
          description: 出错原因
          schema:
            type: string
      summary: 下载文件
      tags:
      - file
  /file/{id}/ls:
    get:
      consumes:
      - application/json
      operationId: /api/file/ls
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 查询路径
        in: query
        name: dir
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/file.info'
                  type: array
              type: object
      summary: 查询文件列表
      tags:
      - file
  /file/{id}/upload:
    post:
      consumes:
      - multipart/form-data
      operationId: /api/file/upload
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 保存路径
        in: formData
        name: dir
        required: true
        type: string
      - description: 文件
        in: formData
        name: file
        required: true
        type: file
      - description: md5校验码
        in: formData
        name: md5
        type: string
      - default: 644
        description: 文件权限（8进制）
        in: formData
        name: mod
        type: integer
      - description: 文件所属用户
        in: formData
        name: own_user
        type: string
      - description: 文件所属分组
        in: formData
        name: own_group
        type: string
      - default: 60
        description: 超时时间
        in: formData
        name: timeout
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 上传文件
      tags:
      - file
  /foo/{id}:
    get:
      consumes:
      - application/json
      operationId: /api/foo
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 调用example类型的agent
      tags:
      - foo
  /info/server:
    get:
      consumes:
      - application/json
      operationId: /api/info/server
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/info.serverInfo'
              type: object
      summary: 获取当前服务器状态
      tags:
      - info
  /ipmi/{id}/device:
    get:
      consumes:
      - application/json
      operationId: /api/ipmi/device
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: IPMI地址
        in: query
        name: addr
        required: true
        type: string
      - description: IPMI用户名
        in: query
        name: user
        required: true
        type: string
      - description: IPMI密码
        in: query
        name: pass
        required: true
        type: string
      - default: auto
        description: IPMI连接模式
        enum:
        - lan
        - lanplus
        - auto
        in: query
        name: mode
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 服务器IPMI信息
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/ipmi.deviceInfo'
              type: object
      summary: 获取服务器的设备信息
      tags:
      - ipmi
  /ipmi/{id}/sensors:
    get:
      consumes:
      - application/json
      description: 常量定义：https://docs.jkservice.org/dp/others/ipmi/defs/
      operationId: /api/ipmi/sensors
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: IPMI地址
        in: query
        name: addr
        required: true
        type: string
      - description: IPMI用户名
        in: query
        name: user
        required: true
        type: string
      - description: IPMI密码
        in: query
        name: pass
        required: true
        type: string
      - default: auto
        description: IPMI连接模式
        enum:
        - lan
        - lanplus
        - auto
        in: query
        name: mode
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 传感器列表
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/ipmi.sensorInfo'
                  type: array
              type: object
      summary: 获取服务器的传感器列表
      tags:
      - ipmi
  /layout/{id}:
    get:
      consumes:
      - application/json
      operationId: /api/layout/status
      parameters:
      - description: 任务ID
        in: query
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/layout.status'
              type: object
      summary: 获取批量任务状态
      tags:
      - layout
  /layout/run:
    post:
      consumes:
      - multipart/form-data
      description: |-
        分组示例:
        当ids参数为exec-01,exec-02,exec-03，group参数为1,1,2时，exec-01和exec-02节点为第一分组并发执行，当执行失败时若onerror参数为exit则不会执行后续分组中的exec-03节点任务
      operationId: /api/layout/run
      parameters:
      - collectionFormat: csv
        description: 节点ID列表
        in: formData
        items:
          type: string
        name: ids
        required: true
        type: array
      - collectionFormat: csv
        description: 分组列表
        in: formData
        items:
          type: integer
        name: group
        required: true
        type: array
      - description: 文件
        in: formData
        name: file
        required: true
        type: file
      - description: 脚本类型
        enum:
        - sh
        - bash
        - python
        - python3
        - bat
        - powershell
        - php
        - lua
        in: formData
        name: type
        required: true
        type: string
      - collectionFormat: csv
        description: 参数
        in: formData
        items:
          type: string
        name: args
        type: array
      - description: md5校验码
        in: formData
        name: md5
        type: string
      - description: 提权方式，仅linux有效
        enum:
        - ""
        - sudo
        - su
        in: formData
        name: auth
        type: string
      - description: 运行身份，仅linux有效
        in: formData
        name: user
        type: string
      - description: 工作目录
        in: formData
        name: workdir
        type: string
      - collectionFormat: csv
        description: 环境变量
        in: formData
        items:
          type: string
        name: env
        type: array
      - default: 60
        description: 单个节点的超时时间
        in: formData
        name: timeout
        type: integer
      - default: exit
        description: 执行失败时的后续操作
        enum:
        - exit
        - continue
        in: formData
        name: onerror
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: payload为任务ID
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  type: string
              type: object
      summary: 批量执行脚本
      tags:
      - layout
  /metrics/{id}/dynamic:
    get:
      consumes:
      - application/json
      description: |-
        1. 当指定top参数时将会获取CPU占用率最高的n个进程数据
        2. 当指定kinds参数时获取的连接类型将会覆盖该agent节点配置文件中的类型设置
        3. 当未指定kinds参数且该agent未配置task.conns.allow类型时默认返回所有类型的连接
      operationId: /api/metrics/dynamic
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 获取进程列表时的数量限制
        in: query
        name: top
        type: integer
      - collectionFormat: csv
        description: 获取连接类型
        in: query
        items:
          enum:
          - tcp
          - tcp4
          - tcp6
          - udp
          - udp4
          - udp6
          - unix
          type: string
        name: kinds
        type: array
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/metrics.dynamicInfo'
              type: object
      summary: 获取节点的所有动态数据
      tags:
      - metrics
  /metrics/{id}/dynamic/connections:
    get:
      consumes:
      - application/json
      description: |-
        1. 当指定kinds参数时获取的连接类型将会覆盖该agent节点配置文件中的类型设置
        2. 当未指定kinds参数且该agent未配置task.conns.allow类型时默认返回所有类型的连接
      operationId: /api/metrics/dynamic/connections
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - collectionFormat: csv
        description: 获取连接类型
        in: query
        items:
          enum:
          - tcp
          - tcp4
          - tcp6
          - udp
          - udp4
          - udp6
          - unix
          type: string
        name: kinds
        type: array
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/metrics.connection'
                  type: array
              type: object
      summary: 获取节点的连接列表数据
      tags:
      - metrics
  /metrics/{id}/dynamic/process:
    get:
      consumes:
      - application/json
      operationId: /api/metrics/dynamic/process
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 数量限制
        in: query
        name: top
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/metrics.process'
                  type: array
              type: object
      summary: 获取节点的所有进程列表数据
      tags:
      - metrics
  /metrics/{id}/dynamic/temps:
    get:
      consumes:
      - application/json
      operationId: /api/metrics/dynamic/temps
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  items:
                    $ref: '#/definitions/metrics.temp'
                  type: array
              type: object
      summary: 获取节点的传感器温度数据
      tags:
      - metrics
  /metrics/{id}/dynamic/usage:
    get:
      consumes:
      - application/json
      operationId: /api/metrics/dynamic/usage
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/metrics.usage'
              type: object
      summary: 获取节点的usage动态数据
      tags:
      - metrics
  /metrics/{id}/static:
    get:
      consumes:
      - application/json
      operationId: /api/metrics/static
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/metrics.staticInfo'
              type: object
      summary: 获取节点的静态数据
      tags:
      - metrics
  /metrics/{id}/status:
    get:
      consumes:
      - application/json
      operationId: /api/metrics/status_get
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/metrics.status'
              type: object
      summary: 获取节点自动采集状态
      tags:
      - metrics
    put:
      consumes:
      - application/json
      operationId: /api/metrics/status_set
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 需启动的任务列表
        in: body
        name: jobs
        required: true
        schema:
          $ref: '#/definitions/metrics.setArgs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 设置节点自动采集状态
      tags:
      - metrics
  /metrics/status:
    put:
      operationId: /api/metrics/batch_status_set
      parameters:
      - description: 需启动的任务列表
        in: body
        name: jobs
        required: true
        schema:
          $ref: '#/definitions/metrics.batchSetArgs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/metrics.counts'
              type: object
      summary: 批量启动或停止采集
      tags:
      - metrics
  /rpa/{id}/in_selector:
    post:
      consumes:
      - application/json
      description: |-
        1. 当RPAAgent返回元素拾取结果时进行回调，即用户选择了某一个界面元素
        2. 使用`POST`方法进行回调
        3. 回调过程中将在请求体中包含以下内容

            ```json
            {
                "id": "rpa-01",               // agent id
                "ts": 1689576608,             // 时间戳
                "cost": 10,                   // 耗时（秒）
                "code": 1,                    // 状态码，1为成功，非1为失败
                "msg": "abc",                 // 错误信息
                "content": "<abc />",         // 元素拾取内容
                "imageUri": "/rpa/files/...", // 拾取元素图像获取uri
                "requestId": "20230728..."    // 请求ID
            }
            ```
      operationId: /api/rpa/in_selector
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 需启动的任务列表
        in: body
        name: args
        required: true
        schema:
          $ref: '#/definitions/rpa.inSelectorArgs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 进入元素选择器状态
      tags:
      - rpa
  /rpa/{id}/selector_validate:
    post:
      consumes:
      - application/json
      operationId: /api/rpa/selector_validate
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 需启动的任务列表
        in: body
        name: args
        required: true
        schema:
          $ref: '#/definitions/rpa.selectorValidateArgs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/api.Success'
      summary: 元素选择器结果验证
      tags:
      - rpa
  /script/{id}/run:
    post:
      consumes:
      - multipart/form-data
      operationId: /api/script/run
      parameters:
      - description: 节点ID
        in: path
        name: id
        required: true
        type: string
      - description: 文件
        in: formData
        name: file
        required: true
        type: file
      - description: 脚本类型
        enum:
        - sh
        - bash
        - python
        - python3
        - bat
        - powershell
        - php
        - lua
        in: formData
        name: type
        required: true
        type: string
      - collectionFormat: csv
        description: 参数
        in: formData
        items:
          type: string
        name: args
        type: array
      - description: md5校验码
        in: formData
        name: md5
        type: string
      - description: 提权方式，仅linux有效
        enum:
        - ""
        - sudo
        - su
        in: formData
        name: auth
        type: string
      - description: 运行身份，仅linux有效
        in: formData
        name: user
        type: string
      - description: 工作目录
        in: formData
        name: workdir
        type: string
      - collectionFormat: csv
        description: 环境变量
        in: formData
        items:
          type: string
        name: env
        type: array
      - default: 60
        description: 超时时间
        in: formData
        name: timeout
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/api.Success'
            - properties:
                payload:
                  $ref: '#/definitions/script.runPayload'
              type: object
      summary: 执行脚本
      tags:
      - script
swagger: "2.0"
tags:
- description: agent相关操作接口
  name: agents
- description: exec-agent执行命令相关操作接口
  name: exec
- description: exec-agent文件处理相关操作接口
  name: file
- description: example-agent相关接口
  name: foo
- description: 服务器端信息相关接口
  name: info
- description: 编排运行相关接口
  name: layout
- description: metrics-agent处理相关接口
  name: metrics
- description: 脚本运行相关接口
  name: script
- description: ipmi相关接口
  name: ipmi
